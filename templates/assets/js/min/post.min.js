const postContext={limited:!1,initCopy(){if("false"!==PageAttrs.metas_enable_copy&&ThemeConfig.enable_copy){const l=location.href,s=$(".joe_detail").attr("data-author");$(".joe_detail__article").on("copy",function(e){var t=window.getSelection(),o=t.toString().replace(/<已自动折叠>/g,""),a=ThemeConfig.enable_copy_right_text?ThemeConfig.copy_right_text||`\r
\r
====================================\r
文章作者： ${s}\r
文章来源： ${ThemeConfig.blog_title}\r
文章链接： ${l}\r
版权声明： 内容遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。`:"";if(window.clipboardData)return window.clipboardData.setData("Text",o+a),!1;{const i=document.body;o=o+a;const n=document.createElement("pre");n.style.position="absolute",n.style.left="-99999px",i.appendChild(n),n.innerText=o,t.selectAllChildren(n),setTimeout(function(){i.removeChild(n)},0)}})}},initShare(){"false"!==PageAttrs.metas_enable_share&&ThemeConfig.enable_share&&(ThemeConfig.enable_share_link&&$(".icon-share-link").length&&$(".icon-share-link").each((e,t)=>{new ClipboardJS($(t)[0],{text:()=>location.href}).on("success",()=>Qmsg.success("文章链接已复制"))}),ThemeConfig.enable_share_weixin)&&$(".qrcode_wx").length&&$(".qrcode_wx").qrcode({width:140,height:140,render:"canvas",typeNumber:-1,correctLevel:0,background:"#ffffff",foreground:"#000000",text:location.href})},initLike(){if("false"!==PageAttrs.metas_enable_like&&ThemeConfig.enable_like&&$(".joe_detail__agree").length){const l=$(".joe_detail").attr("data-cid"),s=+($(".joe_detail").attr("data-clikes")||0);let i=localStorage.getItem(encryption("agree"))?JSON.parse(decrypt(localStorage.getItem(encryption("agree")))):[],n=i.includes(l);const c=$(".joe_detail__agree, .post-operate-like"),r=c.find(".icon-like"),d=c.find(".icon-unlike"),h=c.find(".nums");(n?d:r).addClass("active"),h.html(s);let t=!1;r.on("click",function(e){e.stopPropagation(),t||(t=!0,i=localStorage.getItem(encryption("agree"))?JSON.parse(decrypt(localStorage.getItem(encryption("agree")))):[],n=i.includes(l),$.ajax({url:"/apis/api.halo.run/v1alpha1/trackers/upvote",type:"post",contentType:"application/json; charset=utf-8",data:JSON.stringify({group:"content.halo.run",plural:"posts",name:l})}).then(e=>{let t=s;n?(t--,o=i.findIndex(e=>e===l),i.splice(o,1),d.removeClass("active"),r.addClass("active"),c.removeClass("active")):(t++,i.push(l),r.removeClass("active"),d.addClass("active"),c.addClass("active"));var o=encryption("agree"),a=encryption(JSON.stringify(i));localStorage.setItem(o,a),h.html(t).show()}).catch(e=>{t=!1}))})}},initToc(e){if("false"!==PageAttrs.metas_enable_toc&&ThemeConfig.enable_toc&&$(".toc-container").length){if("true"===PageAttrs.metas_use_raw_content)$("#js-toc").html('<div class="toc-nodata">暂不支持解析原始内容目录</div>');else if("true"===PageAttrs.metas_enable_read_limit&&!e&&postContext.limited)$("#js-toc").html('<div class="toc-nodata">文章内容不完整，目录仅评论后可见</div>');else{const a=$("html"),i=$(".joe_header__mask");e=$(".joe_action .toc");const n=$(".joe_header__toc");var t=$("#js-toc"),o=$("#js-toc-mobile");tocbot.init({tocSelector:Joe.isMobile?"#js-toc-mobile":"#js-toc",contentSelector:".joe_detail__article",ignoreSelector:".js-toc-ignore",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:+(PageAttrs.metas_toc_depth||ThemeConfig.toc_depth||0),scrollSmooth:!0,includeTitleTags:!0,hasInnerContainers:!1,headingsOffset:80,scrollSmoothOffset:-80,positionFixedSelector:".toc-container",positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto",onClick:function(e){Joe.isMobile&&(a.removeClass("disable-scroll"),n.removeClass("active"),i.removeClass("active slideout")),window.tocPhase=!0},scrollEndCallback:function(e){window.tocPhase=null}}),Joe.isMobile?o.children().length||o.html('<div class="toc-nodata"><em></em>暂无目录</div>'):t.children().length||t.html('<div class="toc-nodata">暂无目录</div>'),Joe.isMobile&&(e.show(),e.on("click",()=>{window.sessionStorage.setItem("lastScroll",a.scrollTop()),a.addClass("disable-scroll"),i.addClass("active slideout"),n.addClass("active")}))}$(".toc-container").show()}},initAsideOperate(){if($(".post-operate-comment").on("click",function(e){var t=document.querySelector(".joe_comment"),o=document.querySelector(".joe_header");t&&o&&(e.stopPropagation(),document.getElementsByTagName("halo-comment").length?(e=t.offsetTop-o.offsetHeight-15,window.scrollTo({top:e})):Qmsg.warning("评论功能不可用！"))}),!Joe.isMobile){const t=$(".aside_operations"),o=$(".joe_detail__agree,.joe_detail__operate-share,.joe_detail__operate .joe_donate");var e=e=>{$(".joe_post")[0].getBoundingClientRect().left<75?(t.hide(),o.show()):(t.show(),o.hide())};e(),window.addEventListener("resize",Utils.throttle(e),500)}},initProgress(){if(ThemeConfig.enable_progress_bar){$(window).off("scroll");const i=$(".joe_progress_bar");let t,o,a;$(window).on("scroll",function(e){e.stopPropagation(),t=$(window).height(),o=$("body").height(),a=o-t,window.requestAnimationFrame(function(){var e=Math.max(0,Math.min(1,$(window).scrollTop()/a));e=e,i.css("width",100*e+"%")})})}},initVideo(){if($(".joe_detail__article-video").length){const t=$(".joe_detail__article-video .play iframe").attr("data-player");$(".joe_detail__article-video .episodes .item").on("click",function(e){e.stopPropagation(),$(this).addClass("active").siblings().removeClass("active");e=$(this).attr("data-src");$(".joe_detail__article-video .play iframe").attr({src:t+e})}),$(".joe_detail__article-video .episodes .item").first().click()}},async jumpToComment(){if(!ThemeConfig.enable_clean_mode&&ThemeConfig.enable_comment&&"false"!==PageAttrs.metas_enable_comment){var{cid:e="",p:t=""}=Utils.getUrlParams();if(e){await Utils.sleep(1e3);try{var o,a,i,n=document.getElementsByTagName("halo-comment");n&&(o=$(n[0].shadowRoot.getElementById("halo-comment")).find("#comment-"+e))&&(a=o.offset().top-50,window.scrollTo({top:a}),(i=o.find(".markdown-content").eq(0)).addClass("blink"),await Utils.sleep(2e3),i.removeClass("blink"),window.history.replaceState(null,null,t?"?p="+t:location.origin+location.pathname),tocbot.refresh())}catch(e){console.info(e)}}}}};!function(){const t=["jumpToComment"];document.addEventListener("DOMContentLoaded",function(){Object.keys(postContext).forEach(e=>!t.includes(e)&&"function"==typeof postContext[e]&&postContext[e]())}),window.addEventListener("load",function(){1===t.length?postContext[t[0]]():t.forEach(e=>"loadingBar"!==e&&postContext[e]&&postContext[e]())})}();